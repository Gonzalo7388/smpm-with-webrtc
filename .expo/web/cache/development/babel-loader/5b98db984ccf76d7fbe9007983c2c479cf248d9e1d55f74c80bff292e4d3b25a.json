{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport NativeModules from \"react-native-web/dist/exports/NativeModules\";\nimport MediaStream from \"./MediaStream\";\nimport MediaStreamError from \"./MediaStreamError\";\nimport permissions from \"./Permissions\";\nimport * as RTCUtil from \"./RTCUtil\";\nvar WebRTCModule = NativeModules.WebRTCModule;\nexport default function getUserMedia() {\n  var constraints = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  if (typeof constraints !== 'object') {\n    return Promise.reject(new TypeError('constraints is not a dictionary'));\n  }\n  if ((typeof constraints.audio === 'undefined' || !constraints.audio) && (typeof constraints.video === 'undefined' || !constraints.video)) {\n    return Promise.reject(new TypeError('audio and/or video is required'));\n  }\n  constraints = RTCUtil.normalizeConstraints(constraints);\n  var reqPermissions = [];\n  if (constraints.audio) {\n    reqPermissions.push(permissions.request({\n      name: 'microphone'\n    }));\n  } else {\n    reqPermissions.push(Promise.resolve(false));\n  }\n  if (constraints.video) {\n    reqPermissions.push(permissions.request({\n      name: 'camera'\n    }));\n  } else {\n    reqPermissions.push(Promise.resolve(false));\n  }\n  return new Promise(function (resolve, reject) {\n    Promise.all(reqPermissions).then(function (results) {\n      var _results = _slicedToArray(results, 2),\n        audioPerm = _results[0],\n        videoPerm = _results[1];\n      if (!audioPerm && !videoPerm) {\n        var error = {\n          message: 'Permission denied.',\n          name: 'SecurityError'\n        };\n        reject(new MediaStreamError(error));\n        return;\n      }\n      audioPerm || delete constraints.audio;\n      videoPerm || delete constraints.video;\n      var success = function success(id, tracks) {\n        for (var trackInfo of tracks) {\n          var c = constraints[trackInfo.kind];\n          if (typeof c === 'object') {\n            trackInfo.constraints = RTCUtil.deepClone(c);\n          }\n        }\n        var info = {\n          streamId: id,\n          streamReactTag: id,\n          tracks: tracks\n        };\n        resolve(new MediaStream(info));\n      };\n      var failure = function failure(type, message) {\n        var error;\n        switch (type) {\n          case 'TypeError':\n            error = new TypeError(message);\n            break;\n        }\n        if (!error) {\n          error = new MediaStreamError({\n            message: message,\n            name: type\n          });\n        }\n        reject(error);\n      };\n      WebRTCModule.getUserMedia(constraints, success, failure);\n    });\n  });\n}","map":{"version":3,"names":["MediaStream","MediaStreamError","permissions","RTCUtil","WebRTCModule","NativeModules","getUserMedia","constraints","arguments","length","undefined","Promise","reject","TypeError","audio","video","normalizeConstraints","reqPermissions","push","request","name","resolve","all","then","results","_results","_slicedToArray","audioPerm","videoPerm","error","message","success","id","tracks","trackInfo","c","kind","deepClone","info","streamId","streamReactTag","failure","type"],"sources":["/workspaces/smpm-with-webrtc/node_modules/react-native-webrtc/lib/module/getUserMedia.ts"],"sourcesContent":["\nimport { NativeModules } from 'react-native';\n\n\nimport MediaStream from './MediaStream';\nimport MediaStreamError from './MediaStreamError';\nimport permissions from './Permissions';\nimport * as RTCUtil from './RTCUtil';\n\nconst { WebRTCModule } = NativeModules;\n\ninterface Constraints {\n    audio?: boolean | object;\n    video?: boolean | object;\n}\n\nexport default function getUserMedia(constraints: Constraints = {}): Promise<MediaStream> {\n    // According to\n    // https://www.w3.org/TR/mediacapture-streams/#dom-mediadevices-getusermedia,\n    // the constraints argument is a dictionary of type MediaStreamConstraints.\n    if (typeof constraints !== 'object') {\n        return Promise.reject(new TypeError('constraints is not a dictionary'));\n    }\n\n    if (\n        (typeof constraints.audio === 'undefined' || !constraints.audio) &&\n        (typeof constraints.video === 'undefined' || !constraints.video)\n    ) {\n        return Promise.reject(new TypeError('audio and/or video is required'));\n    }\n\n    // Normalize constraints.\n    constraints = RTCUtil.normalizeConstraints(constraints);\n\n    // Request required permissions\n    const reqPermissions: Promise<boolean>[] = [];\n\n    if (constraints.audio) {\n        reqPermissions.push(permissions.request({ name: 'microphone' }));\n    } else {\n        reqPermissions.push(Promise.resolve(false));\n    }\n\n    if (constraints.video) {\n        reqPermissions.push(permissions.request({ name: 'camera' }));\n    } else {\n        reqPermissions.push(Promise.resolve(false));\n    }\n\n    return new Promise((resolve, reject) => {\n        Promise.all(reqPermissions).then(results => {\n            const [ audioPerm, videoPerm ] = results;\n\n            // Check permission results and remove unneeded permissions.\n\n            if (!audioPerm && !videoPerm) {\n                // https://www.w3.org/TR/mediacapture-streams/#dom-mediadevices-getusermedia\n                // step 4\n                const error = {\n                    message: 'Permission denied.',\n                    name: 'SecurityError'\n                };\n\n                reject(new MediaStreamError(error));\n\n                return;\n            }\n\n            audioPerm || delete constraints.audio;\n            videoPerm || delete constraints.video;\n\n            const success = (id, tracks) => {\n                // Store initial constraints.\n                for (const trackInfo of tracks) {\n                    const c = constraints[trackInfo.kind];\n\n                    if (typeof c === 'object') {\n                        trackInfo.constraints = RTCUtil.deepClone(c);\n                    }\n                }\n\n                const info = {\n                    streamId: id,\n                    streamReactTag: id,\n                    tracks\n                };\n\n                resolve(new MediaStream(info));\n            };\n\n            const failure = (type, message) => {\n                let error;\n\n                switch (type) {\n                    case 'TypeError':\n                        error = new TypeError(message);\n                        break;\n                }\n\n                if (!error) {\n                    error = new MediaStreamError({ message, name: type });\n                }\n\n                reject(error);\n            };\n\n            WebRTCModule.getUserMedia(constraints, success, failure);\n        });\n    });\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}